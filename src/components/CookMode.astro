<label class="relative inline-block w-[48px] h-[26px] select-none">
  <input
    type="checkbox"
    id="cook-mode-toggle"
    class="sr-only"
  />

  <!-- Track -->
  <span
    class="absolute inset-0 bg-zinc-300 rounded-full transition-colors"
    id="cook-track"
  ></span>

  <!-- Handle -->
  <span
    class="absolute h-[22px] w-[22px] left-[2px] top-[2px] bg-zinc-100 rounded-full
           flex items-center justify-center text-[14px] transition-transform"
    id="cook-handle"
  >
    <span id="cook-icon">ðŸŒ™</span>
  </span>
</label>

<script>
  // --- TypeScript types ---------------------------------------------------------

  // Wake Lock API type (not included in TS by default)
  type WakeLockSentinel = {
    release: () => Promise<void>;
    onrelease: (() => void) | null;
    addEventListener: (type: "release", listener: () => void) => void;
  };

  // --- DOM elements --------------------------------------------------------------

  const toggle = document.getElementById("cook-mode-toggle") as HTMLInputElement | null;
  const track = document.getElementById("cook-track") as HTMLSpanElement | null;
  const handle = document.getElementById("cook-handle") as HTMLSpanElement | null;
  const icon = document.getElementById("cook-icon") as HTMLSpanElement | null;

  // --- Wake lock variable --------------------------------------------------------

  let wakeLock: WakeLockSentinel | null = null;

  // --- UI update ---------------------------------------------------------------

  function updateUI(checked: boolean) {
    if (!track || !handle || !icon) return;

    if (checked) {
      // ON state
      track.classList.add("bg-zinc-100");
      track.classList.remove("bg-zinc-300");

      handle.style.transform = "translateX(22px)";
      icon.textContent = "â˜€ï¸";
    } else {
      // OFF state
      track.classList.add("bg-zinc-300");
      track.classList.remove("bg-zinc-100");

      handle.style.transform = "translateX(0px)";
      icon.textContent = "ðŸŒ™";
    }
  }

  // --- Wake lock logic ---------------------------------------------------------

  async function requestWakeLock() {
    try {
      // @ts-ignore - Wake Lock exists in modern browsers
      wakeLock = await navigator.wakeLock.request("screen");

      if (wakeLock !== null) {
        wakeLock.addEventListener("release", () => {
          if (toggle) toggle.checked = false;
          updateUI(false);
        });
      }
    } catch (err) {
      console.error(err);
      if (toggle) toggle.checked = false;
      updateUI(false);
      alert("Wake Lock is not supported on this browser.");
    }
  }

  function releaseWakeLock() {
    if (wakeLock !== null) {
      wakeLock.release();
      wakeLock = null;
    }
  }

  // --- Event listeners ---------------------------------------------------------

  toggle?.addEventListener("change", () => {
    if (!toggle) return;

    updateUI(toggle.checked);

    if (toggle.checked) requestWakeLock();
    else releaseWakeLock();
  });

  // Reacquire wake lock when returning to page
  document.addEventListener("visibilitychange", () => {
    if (wakeLock !== null && document.visibilityState === "visible") {
      requestWakeLock();
    }
  });
</script>
